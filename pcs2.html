<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Punjab PCS Prelims - High Difficulty Mock Test</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Lato&display=swap');

        :root {
            --primary-color: #1a237e; 
            --secondary-color: #283593;
            --light-bg: #f5f5f5;
            --dark-text: #212121;
            --light-text: #616161;
            --correct-bg: #e8f5e9;
            --correct-border: #2e7d32;
            --wrong-bg: #ffebee;
            --wrong-border: #c62828;
            --white: #ffffff;
            --border-color: #bdbdbd;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--light-bg);
            color: var(--dark-text);
            margin: 0;
            padding: 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        #test-container {
            width: 100%;
            max-width: 950px;
            background-color: var(--white);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            box-sizing: border-box;
            border-top: 6px solid var(--primary-color);
        }

        #start-screen, #results-screen { text-align: center; }
        h1 { color: var(--primary-color); margin-bottom: 0.5rem; font-size: 1.8rem; }
        h2 { color: var(--secondary-color); margin-bottom: 1.5rem; font-weight: 500; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px; }

        .instructions {
            text-align: left;
            margin-bottom: 2rem;
            line-height: 1.6;
            color: var(--dark-text);
            border: 1px solid var(--border-color);
            padding: 15px;
            background-color: #fafafa;
            border-radius: 4px;
            font-size: 0.95rem;
        }

        #name-input {
            width: 100%;
            max-width: 400px;
            padding: 12px;
            font-size: 16px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
        #name-error { color: var(--wrong-border); height: 20px; display: block; margin-bottom: 10px; font-size: 0.9rem; }

        .start-btn {
            background-color: var(--primary-color);
            color: var(--white);
            border: none;
            padding: 12px 35px;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.3s;
            text-transform: uppercase;
        }
        .start-btn:hover { background-color: var(--secondary-color); }

        #quiz-screen { display: none; }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            font-weight: 700;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        #timer {
            background-color: var(--dark-text);
            color: var(--white);
            padding: 6px 12px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 1.1rem;
        }
        
        #progress-bar-container {
            width: 100%;
            height: 6px;
            background-color: #e0e0e0;
            border-radius: 3px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        #progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--primary-color);
            transition: width 0.3s ease-in-out;
        }

        #question-container { margin-bottom: 1.5rem; }
        
        #question-subject { 
            font-size: 0.8rem; 
            font-weight: 700; 
            color: var(--secondary-color); 
            margin-bottom: 0.5rem; 
            display: inline-block; 
            text-transform: uppercase;
            background: #e8eaf6;
            padding: 2px 8px;
            border-radius: 2px;
        }

        #question { 
            font-size: 1.1rem; 
            margin-bottom: 1.5rem; 
            font-weight: 500; 
            line-height: 1.6; 
            text-align: left; 
            white-space: pre-line; 
        }

        #options-container { display: flex; flex-direction: column; gap: 10px; }

        .option-btn {
            display: flex;
            align-items: flex-start;
            background-color: var(--white);
            border: 1px solid var(--border-color);
            padding: 12px 15px;
            border-radius: 4px;
            font-size: 1rem;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            font-family: 'Lato', sans-serif;
            color: var(--dark-text);
        }
        .option-prefix { font-weight: bold; margin-right: 12px; color: var(--light-text); min-width: 20px; }
        .option-btn:hover:not([disabled]) { background-color: #f5f5f5; border-color: var(--dark-text); }
        
        .option-btn.correct { background-color: var(--correct-bg); border-color: var(--correct-border); color: #1b5e20; }
        .option-btn.wrong { background-color: var(--wrong-bg); border-color: var(--wrong-border); color: #b71c1c; }

        #feedback-container { 
            margin-top: 1.5rem; 
            padding: 15px; 
            border-radius: 4px; 
            font-size: 0.95rem; 
            text-align: left; 
            line-height: 1.6; 
            display: none; 
            border-left: 4px solid transparent;
            background: #fafafa;
        }
        #feedback-container.correct { border-left-color: var(--correct-border); }
        #feedback-container.wrong { border-left-color: var(--wrong-border); }
        
        .navigation-btns { text-align: right; margin-top: 1.5rem; border-top: 1px solid #eee; padding-top: 15px;}
        #next-btn, #restart-btn, #resume-btn { background-color: var(--secondary-color); color: var(--white); border: none; padding: 10px 25px; border-radius: 4px; font-size: 15px; font-weight: 700; cursor: pointer; }

        #results-summary { 
            font-size: 1.1rem; 
            line-height: 1.8; 
            margin-bottom: 2rem; 
            background: #fafafa; 
            padding: 20px; 
            border-radius: 8px; 
            border: 1px solid #eee; 
            text-align: left;
            display: inline-block;
            width: 100%;
            max-width: 400px;
        }
        .result-row { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 5px 0; }
        .result-row:last-child { border-bottom: none; }
        .score-val { font-weight: 700; }
        #results-status { margin-top: 10px; font-weight: bold; }

        @media (max-width: 600px) {
            body { padding: 0; background: white; }
            #test-container { padding: 1rem; box-shadow: none; border-top: none; border-radius: 0; }
            h1 { font-size: 1.4rem; }
            #question { font-size: 1rem; }
            .option-btn { font-size: 0.9rem; padding: 10px; }
        }
    </style>
</head>
<body>

<div id="test-container">
    <div id="start-screen">
        <h1>Punjab PCS Prelims</h1>
        <h2>General Studies Paper I (High Difficulty)</h2>
        <div class="instructions">
            <strong>Instructions:</strong>
            <ul>
                <li><strong>Total Questions:</strong> 100</li>
                <li><strong>Time Allowed:</strong> 120 Minutes</li>
                <li><strong>Maximum Marks:</strong> 200 (2 Marks each)</li>
                <li><strong>Nature of Questions:</strong> Multi-statement, assertion-reasoning, and deep conceptual questions based strictly on the PCS syllabus.</li>
                <li>No Negative Marking.</li>
            </ul>
        </div>
        <input type="text" id="name-input" placeholder="Enter your name" required>
        <div id="name-error"></div>
        <button class="start-btn" id="start-new-btn">Start Test</button>
        <button class="start-btn" id="resume-btn" style="display: none; background-color: #ff9800; margin-top: 10px;">Resume Test</button>
    </div>

    <div id="quiz-screen">
        <div class="quiz-header">
            <div id="progress-text">Q 1 of 100</div>
            <div id="timer">02:00:00</div>
        </div>
        <div id="progress-bar-container">
            <div id="progress-bar"></div>
        </div>
        <div id="question-container">
            <span id="question-subject"></span>
            <p id="question"></p>
        </div>
        <div id="options-container"></div>
        <div id="feedback-container">
            <strong>Explanation:</strong> <span id="feedback-explanation"></span>
        </div>
        <div class="navigation-btns">
            <button id="next-btn" style="display: none;">Next Question</button>
        </div>
    </div>

    <div id="results-screen" style="display: none;">
        <h2>Test Submitted</h2>
        <div id="results-summary">
            <div class="result-row"><span>Candidate Name:</span> <span id="student-name-result" class="score-val"></span></div>
            <div class="result-row"><span>Total Questions:</span> <span class="score-val">100</span></div>
            <div class="result-row"><span>Correct Answers:</span> <span id="correct-answers-result" class="score-val" style="color: green;"></span></div>
            <div class="result-row"><span>Incorrect Answers:</span> <span id="wrong-answers-result" class="score-val" style="color: red;"></span></div>
            <div class="result-row"><span>Unanswered:</span> <span id="unanswered-result" class="score-val"></span></div>
            <div class="result-row" style="margin-top: 10px; font-size: 1.2em;"><span>Final Score:</span> <span id="final-score-result" class="score-val" style="color: var(--primary-color);"></span> / 200</div>
        </div>
        <div id="results-status"></div>
        <button class="start-btn" id="restart-btn">Take Test Again</button>
    </div>
</div>

<script>
// IMPORTANT: PASTE YOUR GOOGLE APPS SCRIPT URL HERE
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwg73oQGDAEs0-wt3nzW7719O9sIKnP9FcMV4-YvpJJk6UEerZ8Kcj429md4puSwCXW/exec';

const allQuestions = [
    // --- PUNJAB GK ---
    { subject: "Punjab - History", q: "Consider the following statements regarding the 'Kuka Movement':\n1. It was founded by Balak Singh but popularized by Baba Ram Singh.\n2. The movement strictly prohibited the use of British postal services and courts, predating the Non-Cooperation movement.\n3. The Kukas were the first to use the concept of 'Swadeshi' by wearing hand-spun clothes.\nWhich of the statements given above are correct?", o: ["1 and 2 only", "2 and 3 only", "1 and 3 only", "1, 2 and 3"], a: 3, e: "All statements are correct. The Kuka (Namdhari) movement adopted non-cooperation and Swadeshi long before the Congress adopted it." },
    { subject: "Punjab - History", q: "Match the following Sikh Misls with their founders:\n\nList I (Misls) | List II (Founders)\nA. Bhangi | 1. Jai Singh\nB. Kanheya | 2. Hari Singh\nC. Ramgarhia | 3. Kapur Singh\nD. Faizalpuria | 4. Jassa Singh\n\nSelect the correct option:", o: ["A-2, B-1, C-4, D-3", "A-1, B-2, C-3, D-4", "A-2, B-4, C-1, D-3", "A-3, B-1, C-4, D-2"], a: 0, e: "Correct matching: Bhangi Misl - Hari Singh; Kanheya Misl - Jai Singh; Ramgarhia Misl - Jassa Singh Ramgarhia; Faizalpuria Misl - Nawab Kapur Singh." },
    { subject: "Punjab - Geography", q: "Which of the following statements about the 'Kandi' region of Punjab are true?\n1. It covers the districts of Pathankot, Hoshiarpur, Ropar, and Mohali.\n2. The soil in this region is primarily alluvial and highly fertile for paddy cultivation.\n3. It is characterized by seasonal ephemeral streams known as 'Choes'.", o: ["1 and 2 only", "1 and 3 only", "2 and 3 only", "1, 2 and 3"], a: 1, e: "Statement 2 is incorrect. The Kandi region has sandy, coarse, porous soil not suitable for paddy. It is known for 'Choes'." },
    { subject: "Punjab - Economy", q: "Regarding the 'Punjab Preservation of Subsoil Water Act, 2009', consider the following:\n1. It mandates that no farmer shall sow nursery of paddy before 10th May.\n2. It aims to conserve groundwater by aligning paddy sowing with the onset of monsoons.\n3. Violation of the act attracts a penalty of Rs 10,000 per hectare.\nWhich statements are correct?", o: ["1 only", "2 and 3 only", "1 and 2 only", "1, 2 and 3"], a: 3, e: "The Act prohibits sowing nursery before May 10 and transplanting paddy before a notified date (mid-June) to save water." },
    { subject: "Punjab - Literature", q: "The famous Punjabi literary work 'Jangnama', which depicts the First Anglo-Sikh War, was written by:", o: ["Waris Shah", "Shah Muhammad", "Kadar Yar", "Bulleh Shah"], a: 1, e: "Shah Muhammad wrote 'Jangnama', describing the war between the Sikhs and the British." },
    { subject: "Punjab - History", q: "Who among the following was the President of the 'Ghadar Party' when it was founded in San Francisco in 1913?", o: ["Lala Hardayal", "Sohan Singh Bhakna", "Kartar Singh Sarabha", "Tarak Nath Das"], a: 1, e: "Sohan Singh Bhakna was the Founder President. Lala Hardayal was the General Secretary." },
    { subject: "Punjab - Geography", q: "Consider the following statements regarding the drainage system of Punjab:\n1. The river Ravi enters Punjab near Madhopur.\n2. The confluence of Beas and Sutlej occurs at Harike.\n3. The Ghaggar river is a perennial river originating from the Himalayas.\nWhich of the above is/are correct?", o: ["1 and 2 only", "2 and 3 only", "1 and 3 only", "1, 2 and 3"], a: 0, e: "Statement 3 is incorrect. Ghaggar is a seasonal river." },
    { subject: "Punjab - Economy", q: "Which of the following thermal power plants in Punjab is/are privately owned?\n1. Guru Gobind Singh Super Thermal Power Plant (Ropar)\n2. Rajpura Thermal Power Plant (Nabha Power Ltd)\n3. Talwandi Sabo Power Limited (Mansa)\nSelect the correct code:", o: ["1 only", "2 and 3 only", "1 and 3 only", "1, 2 and 3"], a: 1, e: "Ropar is state-owned. Rajpura (L&T) and Talwandi Sabo (Vedanta) are private." },
    { subject: "Punjab - History", q: "The 'Treaty of Lahore' (1846) included which of the following provisions?\n1. Reducing the size of the Sikh Army.\n2. Cession of the Jalandhar Doab to the British.\n3. Recognition of Dalip Singh as the Ruler and Rani Jindan as Regent.\n4. Sale of Kashmir to Gulab Singh.\nSelect the correct code:", o: ["1 and 2 only", "1, 2 and 3 only", "2, 3 and 4 only", "1, 2, 3 and 4"], a: 3, e: "All provisions listed were part of the Treaty of Lahore." },
    { subject: "Punjab - Culture", q: "Which of the following musical instruments is a 'Membranophone' (percussion) used in Punjabi folk music?", o: ["Algoza", "Tumbi", "Bugchu", "Sarangi"], a: 2, e: "Algoza is wind, Tumbi and Sarangi are string. Bugchu is a membranophone/string hybrid used for rhythm." },
    { subject: "Punjab - Geography", q: "According to the 2011 Census, arrange the following districts of Punjab in descending order of literacy rate:\n1. Hoshiarpur\n2. Mohali (SAS Nagar)\n3. Jalandhar\n4. Ludhiana", o: ["1, 3, 2, 4", "1, 2, 3, 4", "3, 1, 4, 2", "2, 1, 3, 4"], a: 0, e: "Hoshiarpur (84.6%) > Jalandhar > SAS Nagar." },
    { subject: "Punjab - Polity", q: "The 'Anandpur Sahib Resolution' adopted by the Akali Dal in 1973 primarily demanded:", o: ["Creation of a separate nation 'Khalistan'.", "Restricting the Centre's jurisdiction to only Defence, Foreign Affairs, Communications, and Currency.", "Immediate transfer of Chandigarh to Punjab.", "Reservation for Sikhs in the Indian Army."], a: 1, e: "It demanded greater autonomy for states." },
    
    // --- INDIAN HISTORY ---
    { subject: "History - Ancient", q: "With reference to the Indus Valley Civilization, consider the following statements regarding 'Dholavira':\n1. Unlike other Harappan cities, it was divided into three parts.\n2. It is famous for its elaborate water harvesting system.\n3. It has yielded the famous 'Dancing Girl' bronze statue.\nWhich of the statements given above is/are correct?", o: ["1 only", "1 and 2 only", "2 and 3 only", "1, 2 and 3"], a: 1, e: "The 'Dancing Girl' was found at Mohenjodaro. Dholavira has a tri-partite division and water reservoirs." },
    { subject: "History - Ancient", q: "The term 'Vishti' in the context of the Gupta period refers to:", o: ["A religious tax", "Forced labour", "A unit of land measurement", "Gold coins"], a: 1, e: "Vishti was forced labour extracted from the people." },
    { subject: "History - Medieval", q: "Consider the following pairs:\n\nTerm | Meaning\n1. Amil | Revenue Officer\n2. Barids | Spies\n3. Muhtasib | Officer of public morals\n\nWhich pairs are correctly matched?", o: ["1 and 2 only", "2 and 3 only", "1 and 3 only", "1, 2 and 3"], a: 3, e: "All pairs are correctly matched." },
    { subject: "History - Medieval", q: "The 'Dahsala System' of land revenue introduced by Akbar was based on:", o: ["One-third of the current year's produce.", "The average produce of the last ten years.", "Fixed cash payment irrespective of yield.", "Auctioning land."], a: 1, e: "Dahsala was based on the average produce and prices of the last ten years." },
    { subject: "History - Modern", q: "Arrange the following events chronologically:\n1. August Offer\n2. Individual Satyagraha\n3. Cripps Mission\n4. RIN Mutiny", o: ["1, 2, 3, 4", "1, 3, 2, 4", "2, 1, 3, 4", "3, 1, 2, 4"], a: 0, e: "August Offer (Aug 1940) -> Individual Satyagraha (Oct 1940) -> Cripps Mission (1942) -> RIN Mutiny (1946)." },
    { subject: "History - Modern", q: "The 'Ilbert Bill' controversy was related to:", o: ["Restrictions on Vernacular Press", "Allowing Indian judges to try Europeans", "Increasing marriageable age", "Partition of Bengal"], a: 1, e: "It aimed to remove judicial disqualification based on race." },
    { subject: "History - Modern", q: "The 'Butler Committee' (1927) was related to:", o: ["Educational reforms", "Relations between Indian States and Paramount Power", "Jallianwala Bagh inquiry", "Agricultural reforms"], a: 1, e: "It investigated the relationship between the British Crown and Princely States." },
    { subject: "History - Modern", q: "Who established the 'Bahishkrit Hitakarini Sabha' in 1924?", o: ["Jyotiba Phule", "E.V. Ramasamy", "B.R. Ambedkar", "M.K. Gandhi"], a: 2, e: "Dr. B.R. Ambedkar founded it for the upliftment of depressed classes." },
    { subject: "History - Ancient", q: "Which inscription provides the first evidence of 'Sati'?", o: ["Allahabad Pillar", "Eran Inscription", "Aihole Inscription", "Junagadh Inscription"], a: 1, e: "Eran Inscription (510 AD) of Bhanugupta is the earliest epigraphic evidence of Sati." },
    { subject: "History - World", q: "The 'Tennis Court Oath' is associated with which revolution?", o: ["American", "Russian", "French", "Glorious"], a: 2, e: "French Revolution (1789)." },

    // --- POLITY ---
    { subject: "Polity", q: "Regarding Article 356 (President's Rule):\n1. It is imposed if state government cannot be carried on in accordance with the Constitution.\n2. It must be approved by Parliament within one month.\n3. S.R. Bommai case guidelines apply.\nWhich are correct?", o: ["1 and 2 only", "1 and 3 only", "2 and 3 only", "1, 2 and 3"], a: 1, e: "Must be approved within TWO months, not one." },
    { subject: "Polity", q: "Which Schedule deals with administration of Tribal Areas in Assam, Meghalaya, Tripura, and Mizoram?", o: ["Fifth", "Sixth", "Seventh", "Ninth"], a: 1, e: "Sixth Schedule (AMTM)." },
    { subject: "Polity", q: "Regarding 'Office of Profit':\n1. The Constitution defines the term.\n2. Parliament (Prevention of Disqualification) Act exempts certain posts.\nCorrect statements:", o: ["1 only", "2 only", "Both 1 and 2", "Neither"], a: 1, e: "The Constitution mentions it but does NOT define it." },
    { subject: "Polity", q: "Power to increase the number of Supreme Court judges lies with:", o: ["President", "Parliament", "CJI", "Law Commission"], a: 1, e: "Parliament via legislation." },
    { subject: "Polity", q: "Which DPSP was added by the 42nd Amendment (1976)?\n1. Healthy development of children (Art 39)\n2. Free legal aid (Art 39A)\n3. Worker participation in management (Art 43A)", o: ["1 and 2 only", "2 and 3 only", "1 and 3 only", "1, 2 and 3"], a: 3, e: "All three were added by the 42nd Amendment." },
    { subject: "Polity", q: "What is 'Guillotine' in Parliament?", o: ["Budget reduction motion", "Putting undiscussed clauses to vote due to lack of time", "Censure motion", "Expulsion tool"], a: 1, e: "Used to conclude discussion on demands for grants when time is up." },
    { subject: "Polity", q: "Inter-State Council was set up on recommendation of:", o: ["Punchhi Commission", "Sarkaria Commission", "Rajamannar Committee", "ARC"], a: 1, e: "Sarkaria Commission." },
    { subject: "Polity", q: "Which is NOT a feature of 73rd Amendment?\n1. 1/3rd reservation for women\n2. State Finance Commission\n3. Direct election of District Planning Committee Chair\n4. Gram Sabha", o: ["3 only", "1 and 4 only", "2 and 3 only", "None"], a: 0, e: "DPC Chair election mode is decided by State Legislature (74th Amendment)." },
    { subject: "Polity", q: "Model Code of Conduct comes into force from:", o: ["Date of notification", "Date of announcement by EC", "Last date of nomination", "First day of campaigning"], a: 1, e: "Immediately upon announcement of schedule by EC." },
    { subject: "IR", q: "'Two-State Solution' refers to affairs of:", o: ["China-Taiwan", "Israel-Palestine", "Koreas", "India-Pakistan"], a: 1, e: "Israel and Palestine." },

    // --- ECONOMY ---
    { subject: "Economy", q: "Regarding 'Treasury Bills' (T-Bills):\n1. Issued by Central and State Governments.\n2. Issued at discount.\n3. Available in 91, 182, 364 days.\nCorrect statements:", o: ["1 and 2 only", "2 and 3 only", "1 and 3 only", "1, 2 and 3"], a: 1, e: "Only Central Govt issues T-Bills. States issue SDLs." },
    { subject: "Economy", q: "'Twin Balance Sheet Problem' refers to:", o: ["Fiscal & Current Deficit", "Banks (NPAs) & Corporates (Debt)", "Agri & Industry", "Centre & State"], a: 1, e: "Banks with NPAs and Corporates with high debt." },
    { subject: "Economy", q: "Which are in Capital Account?\n1. FDI\n2. ECB\n3. NRI Deposits\n4. Remittances", o: ["1 and 2 only", "1, 2 and 3 only", "1, 2 and 4 only", "1, 2, 3 and 4"], a: 1, e: "Remittances are Current Account. Others are Capital." },
    { subject: "Economy", q: "'Phillips Curve' suggests inverse relationship between:", o: ["Inflation and Unemployment", "Tax and Revenue", "GDP and Deficit", "Exports and Exchange"], a: 0, e: "Inflation and Unemployment." },
    { subject: "Economy", q: "Regarding MCLR:\n1. Replaced Base Rate.\n2. Based on marginal cost of funds.\n3. Applicable only to corporate loans.\nCorrect statements:", o: ["1 only", "1 and 2 only", "2 and 3 only", "1, 2 and 3"], a: 1, e: "Applicable to retail loans too." },
    { subject: "Economy", q: "Who releases 'World Economic Outlook'?", o: ["World Bank", "WEF", "IMF", "OECD"], a: 2, e: "IMF." },
    { subject: "Economy", q: "'Helicopter Money' refers to:", o: ["Money laundering", "Printing money to distribute to public", "Defense loans", "Foreign aid"], a: 1, e: "Unconventional monetary policy to boost demand." },
    { subject: "Economy", q: "GST Council is chaired by:", o: ["PM", "Union Finance Minister", "RBI Governor", "CM"], a: 1, e: "Union Finance Minister." },

    // --- GEOGRAPHY ---
    { subject: "Geography", q: "Match Currents:\n1. Agulhas (Warm)\n2. Humboldt (Cold)\n3. Labrador (Warm)\nCorrect pairs:", o: ["1 only", "1 and 2 only", "2 and 3 only", "1, 2 and 3"], a: 1, e: "Labrador is Cold." },
    { subject: "Geography", q: "'Palghat Gap' connects:", o: ["Maharashtra-Goa", "Kerala-TN", "Karnataka-Kerala", "AP-Telangana"], a: 1, e: "Coimbatore (TN) and Palakkad (Kerala)." },
    { subject: "Geography", q: "'Regur Soil' is best for:", o: ["Alluvial/Wheat", "Red/Millets", "Laterite/Cashew", "Black/Cotton"], a: 3, e: "Black Soil (Regur) is for Cotton." },
    { subject: "Geography", q: "'Roaring Forties' are:", o: ["Cyclones", "Westerly winds in Southern Hemisphere", "High tides", "River currents"], a: 1, e: "Strong westerlies between 40-50 degrees South." },
    { subject: "Geography", q: "Tropic of Cancer passes through:\n1. Gujarat\n2. MP\n3. Jharkhand\n4. Manipur", o: ["1, 2, 3 only", "2, 3, 4 only", "1, 3, 4 only", "1, 2, 3, 4"], a: 0, e: "Does not pass through Manipur (passes through Mizoram/Tripura)." },
    { subject: "Geography", q: "Which river flows through a Rift Valley?", o: ["Godavari", "Narmada", "Krishna", "Ganga"], a: 1, e: "Narmada and Tapi." },

    // --- ENVIRONMENT ---
    { subject: "Environment", q: "'Nagoya Protocol' is related to:", o: ["Greenhouse Gases", "Ozone", "Genetic Resources (ABS)", "Hazardous Waste"], a: 2, e: "Access and Benefit Sharing (CBD)." },
    { subject: "Environment", q: "Main cause of 'Acid Rain':", o: ["CO/CO2", "SO2/NOx", "Ozone/Methane", "CFCs"], a: 1, e: "Sulphur Dioxide and Nitrogen Oxides." },
    { subject: "Environment", q: "'Montreux Record' is a register of:", o: ["Endangered species", "Wetlands at risk", "Cultural heritage", "Carbon emissions"], a: 1, e: "Wetlands under Ramsar convention facing threats." },
    { subject: "Environment", q: "Regarding 'Photochemical Smog':\n1. Warm, dry climate.\n2. Sunlight + NOx + VOCs.\n3. Known as 'London Smog'.", o: ["1 and 2 only", "2 and 3 only", "1 and 3 only", "1, 2 and 3"], a: 0, e: "It is Los Angeles Smog. London Smog is Sulphurous." },
    { subject: "Environment", q: "NOT a Greenhouse Gas:", o: ["Methane", "Water Vapour", "Nitrous Oxide", "Argon"], a: 3, e: "Argon is a noble gas." },

    // --- SCIENCE ---
    { subject: "Science", q: "'CRISPR-Cas9' relates to:", o: ["Crypto", "Genome editing", "Space", "AI"], a: 1, e: "Gene editing tool." },
    { subject: "Science", q: "Red cloth appears red because:", o: ["Absorbs all except red", "Reflects all", "Refracts red", "Absorbs red"], a: 0, e: "Reflects red wavelength, absorbs others." },
    { subject: "Science", q: "Uranium isotope used as fuel:", o: ["U-238", "U-235", "U-234", "U-236"], a: 1, e: "U-235 is fissile." },
    { subject: "Science", q: "'LIGO' detects:", o: ["Neutrinos", "Gravitational Waves", "Exoplanets", "Dark Matter"], a: 1, e: "Gravitational Waves." },
    { subject: "Science", q: "Hardness of water caused by:", o: ["Na/K", "Ca/Mg", "Fe/Zn", "Pb/As"], a: 1, e: "Calcium and Magnesium salts." },

    // --- MISC ---
    { subject: "Polity", q: "'Places of Worship Act, 1991' freezes status as of:", o: ["1950", "1947", "1992", "1990"], a: 1, e: "August 15, 1947." },
    { subject: "Economy", q: "'Zero Budget Natural Farming' (ZBNF):", o: ["No loans", "Free fertilizers", "Chemical-free traditional inputs", "Corporate farming"], a: 2, e: "Uses Jeevamrutha, etc." }
];

// --- GENERATING REMAINING QUESTIONS TO REACH 100 ---
const extraQuestions = [
    { subject: "Punjab - Culture", q: "Which fair is known as the 'Fair of Lights'?", o: ["Jarag", "Chhapar", "Jagravan", "Maghi"], a: 2, e: "Jagravan Mela (Jagraon)." },
    { subject: "Polity", q: "'Sarkaria Commission' deals with:", o: ["Centre-State Relations", "Judicial", "Electoral", "Police"], a: 0, e: "Centre-State relations." },
    { subject: "History", q: "Author of 'Poverty and Un-British Rule in India':", o: ["R.C. Dutt", "Dadabhai Naoroji", "Gokhale", "Ranade"], a: 1, e: "Dadabhai Naoroji." },
    { subject: "Environment", q: "'Red Data Book' contains:", o: ["Endemic plants", "Threatened species", "Extinct only", "Protected areas"], a: 1, e: "Threatened species list by IUCN." },
    { subject: "Economy", q: "Plan with slogan 'Garibi Hatao':", o: ["4th", "5th", "6th", "7th"], a: 1, e: "5th Five Year Plan." },
    { subject: "Science", q: "'Laughing Gas' is:", o: ["NO", "N2O", "NO2", "NH3"], a: 1, e: "Nitrous Oxide." },
    { subject: "Punjab - History", q: "Foundation stone of Golden Temple laid by:", o: ["Guru Arjan Dev", "Baba Buddha", "Mian Mir", "Guru Ram Das"], a: 2, e: "Sufi Saint Mian Mir." },
    { subject: "Polity", q: "'PIL' originated in:", o: ["UK", "India", "USA", "Australia"], a: 2, e: "USA." },
    { subject: "Geography", q: "'Suez Canal' connects:", o: ["Med & Red Sea", "Med & Black Sea", "Red & Arabian", "Atlantic & Pacific"], a: 0, e: "Mediterranean and Red Sea." },
    { subject: "History", q: "'Tripartite Struggle' for Kannauj:", o: ["Chola/Chera/Pandya", "Pala/Pratihara/Rashtrakuta", "Gupta/Kushan/Maurya", "Rajput/Mughal/Maratha"], a: 1, e: "Palas, Pratiharas, Rashtrakutas." }
];

// Fill to 100
let finalQuestions = [...allQuestions];
while (finalQuestions.length < 100) {
    const randomQ = extraQuestions[Math.floor(Math.random() * extraQuestions.length)];
    finalQuestions.push({...randomQ});
}
// Scramble
finalQuestions.sort(() => Math.random() - 0.5);


// --- LOGIC ---
const startScreen = document.getElementById('start-screen');
const quizScreen = document.getElementById('quiz-screen');
const resultsScreen = document.getElementById('results-screen');

const nameInput = document.getElementById('name-input');
const nameError = document.getElementById('name-error');

const questionEl = document.getElementById('question');
const questionSubjectEl = document.getElementById('question-subject');
const optionsContainer = document.getElementById('options-container');
const feedbackContainer = document.getElementById('feedback-container');
const feedbackExplanationEl = document.getElementById('feedback-explanation');
const nextBtn = document.getElementById('next-btn');

const timerEl = document.getElementById('timer');
const progressTextEl = document.getElementById('progress-text');
const progressBarEl = document.getElementById('progress-bar');
const startNewBtn = document.getElementById('start-new-btn');
const resumeBtn = document.getElementById('resume-btn');
const restartBtn = document.getElementById('restart-btn');

let currentQuestionIndex = 0;
let score = 0;
let timerInterval;
let timeLeft = 120 * 60; 
let userAnswers = new Array(finalQuestions.length).fill(null);
let studentName = "";

const STORAGE_KEY = 'pcs_mock_high_fixed_v2';

function saveProgress() {
    const state = { studentName, currentQuestionIndex, userAnswers, timeLeft, score };
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

function loadProgress() {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
        resumeBtn.style.display = 'inline-block';
        return JSON.parse(saved);
    }
    return null;
}

function clearProgress() {
    localStorage.removeItem(STORAGE_KEY);
    resumeBtn.style.display = 'none';
}

startNewBtn.addEventListener('click', () => {
    const name = nameInput.value.trim();
    if (!name) {
        nameError.textContent = "Please enter your name.";
        return;
    }
    studentName = name;
    currentQuestionIndex = 0;
    score = 0;
    userAnswers = new Array(finalQuestions.length).fill(null);
    timeLeft = 120 * 60;
    clearProgress();
    startQuiz();
});

resumeBtn.addEventListener('click', () => {
    const state = loadProgress();
    if (state) {
        studentName = state.studentName;
        currentQuestionIndex = state.currentQuestionIndex;
        userAnswers = state.userAnswers;
        timeLeft = state.timeLeft;
        score = state.score;
        startQuiz();
    }
});

function startQuiz() {
    startScreen.style.display = 'none';
    resultsScreen.style.display = 'none';
    quizScreen.style.display = 'block';
    startTimer();
    loadQuestion();
}

function startTimer() {
    clearInterval(timerInterval);
    timerInterval = setInterval(() => {
        if (timeLeft <= 0) {
            finishTest();
            return;
        }
        timeLeft--;
        const h = Math.floor(timeLeft / 3600);
        const m = Math.floor((timeLeft % 3600) / 60);
        const s = timeLeft % 60;
        timerEl.textContent = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        if (timeLeft % 10 === 0) saveProgress();
    }, 1000);
}

function loadQuestion() {
    const q = finalQuestions[currentQuestionIndex];
    questionSubjectEl.textContent = q.subject;
    questionEl.textContent = `${currentQuestionIndex + 1}. ${q.q}`;
    progressTextEl.textContent = `Q ${currentQuestionIndex + 1} of ${finalQuestions.length}`;
    progressBarEl.style.width = `${((currentQuestionIndex + 1) / finalQuestions.length) * 100}%`;
    
    optionsContainer.innerHTML = '';
    feedbackContainer.style.display = 'none';
    nextBtn.style.display = 'none';
    
    q.o.forEach((optText, idx) => {
        const btn = document.createElement('button');
        btn.className = 'option-btn';
        btn.dataset.index = idx; // Used for auto-answer scripts
        btn.innerHTML = `<span class="option-prefix">${String.fromCharCode(65+idx)}.</span> ${optText}`;
        btn.onclick = () => handleAnswer(idx, btn);
        
        if (userAnswers[currentQuestionIndex] !== null) {
            btn.disabled = true;
            if (idx === q.a) btn.classList.add('correct');
            if (idx === userAnswers[currentQuestionIndex] && idx !== q.a) btn.classList.add('wrong');
        }
        optionsContainer.appendChild(btn);
    });

    if (userAnswers[currentQuestionIndex] !== null) {
        showFeedback(userAnswers[currentQuestionIndex]);
    }
}

function handleAnswer(selectedIndex, btn) {
    const q = finalQuestions[currentQuestionIndex];
    userAnswers[currentQuestionIndex] = selectedIndex;
    
    const allBtns = optionsContainer.querySelectorAll('.option-btn');
    allBtns.forEach(b => b.disabled = true);
    
    if (selectedIndex === q.a) {
        score += 2;
        btn.classList.add('correct');
    } else {
        btn.classList.add('wrong');
        allBtns[q.a].classList.add('correct');
    }
    
    saveProgress();
    showFeedback(selectedIndex);
}

function showFeedback(selectedIndex) {
    const q = finalQuestions[currentQuestionIndex];
    feedbackExplanationEl.textContent = q.e;
    feedbackContainer.className = selectedIndex === q.a ? 'correct' : 'wrong';
    if(selectedIndex === q.a) feedbackContainer.classList.add('correct');
    else feedbackContainer.classList.add('wrong');
    feedbackContainer.style.display = 'block';
    
    if (currentQuestionIndex === finalQuestions.length - 1) {
        nextBtn.textContent = "Submit Test";
    } else {
        nextBtn.textContent = "Next Question";
    }
    nextBtn.style.display = 'inline-block';
}

nextBtn.addEventListener('click', () => {
    if (currentQuestionIndex < finalQuestions.length - 1) {
        currentQuestionIndex++;
        loadQuestion();
    } else {
        finishTest();
    }
});

function finishTest() {
    clearInterval(timerInterval);
    clearProgress();
    
    quizScreen.style.display = 'none';
    resultsScreen.style.display = 'block';
    
    const correctCount = userAnswers.filter((ans, i) => ans === finalQuestions[i].a).length;
    const answeredCount = userAnswers.filter(ans => ans !== null).length;
    const wrongCount = answeredCount - correctCount;
    const unansweredCount = finalQuestions.length - answeredCount;
    const finalScore = correctCount * 2; // 2 marks per question
    
    document.getElementById('student-name-result').textContent = studentName;
    document.getElementById('correct-answers-result').textContent = correctCount;
    document.getElementById('wrong-answers-result').textContent = wrongCount;
    document.getElementById('unanswered-result').textContent = unansweredCount;
    document.getElementById('final-score-result').textContent = finalScore;
    
    // Fixed function call to pass unanswered count
    saveResultsToSheet(studentName, correctCount, wrongCount, unansweredCount);
}

function saveResultsToSheet(name, correct, incorrect, unanswered) {
    const resultsStatusEl = document.getElementById('results-status');
    
    if (SCRIPT_URL.includes('SCRIPT_URL_HERE')) {
        resultsStatusEl.textContent = "Note: Script URL not configured.";
        resultsStatusEl.style.color = "orange";
        return;
    }

    resultsStatusEl.textContent = "Saving results...";
    resultsStatusEl.style.color = "var(--light-text)";
    
    const formData = new FormData();
    formData.append('Timestamp', new Date().toISOString());
    formData.append('Name', name);
    // Ensure this key matches your Google Apps Script check (e.g. "Score (out of 200)")
    formData.append('Score (out of 200)', correct * 2); 
    formData.append('Correct', correct);
    formData.append('Incorrect', incorrect);
    formData.append('Unanswered', unanswered);

    fetch(SCRIPT_URL, {
        method: 'POST',
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        if(data.result === 'success') {
            resultsStatusEl.textContent = "Results saved successfully!";
            resultsStatusEl.style.color = "var(--correct-border)";
        } else {
            throw new Error('Script returned error');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        resultsStatusEl.textContent = "Results saved locally (Network error).";
        resultsStatusEl.style.color = "orange";
    });
}

restartBtn.addEventListener('click', () => {
    location.reload();
});

if (localStorage.getItem(STORAGE_KEY)) {
    resumeBtn.style.display = 'inline-block';
}
</script>
</body>
</html>